<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Retell Debug Page</title>
  <style>
    html, body { height: 100%; margin: 0; font-family: Arial, sans-serif; }
    .debug-info { padding: 20px; background: #f5f5f5; border-bottom: 2px solid #ddd; }
    .debug-info h2 { margin: 0 0 10px 0; color: #333; }
    .debug-info p { margin: 5px 0; }
    .status { padding: 4px 8px; border-radius: 4px; font-weight: bold; }
    .success { background: #d4edda; color: #155724; }
    .error { background: #f8d7da; color: #721c24; }
    .warning { background: #fff3cd; color: #856404; }
    #widget-container { height: calc(100% - 200px); border: 2px solid #ddd; margin: 20px; }
  </style>
</head>
<body>
  <div class="debug-info">
    <h2>üîç Retell Widget Debug Information</h2>
    <p><strong>Public Key:</strong> key_dd6ca6cd20325ba137fb797e1dc2</p>
    <p><strong>Agent ID:</strong> agent_36d15796190bcb840206f004e4</p>
    <p><strong>Current Domain:</strong> <span id="current-domain"></span></p>
    <p><strong>Widget Load Status:</strong> <span id="widget-status" class="status warning">Loading...</span></p>
    <p><strong>Console Errors:</strong> <span id="console-errors" class="status success">None</span></p>
  </div>

  <div id="widget-container"></div>

  <script>
    // Display current domain
    document.getElementById('current-domain').textContent = window.location.hostname;

    // Capture console errors
    let hasErrors = false;
    const originalError = console.error;
    console.error = function(...args) {
      hasErrors = true;
      document.getElementById('console-errors').textContent = args.join(' ');
      document.getElementById('console-errors').className = 'status error';
      originalError.apply(console, args);
    };

    // Load the Retell widget
    const script = document.createElement('script');
    script.id = 'retell-widget';
    script.src = 'https://dashboard.retellai.com/retell-widget.js';
    script.type = 'module';
    script.setAttribute('data-public-key', 'key_dd6ca6cd20325ba137fb797e1dc2');
    script.setAttribute('data-agent-id', 'agent_36d15796190bcb840206f004e4');
    script.setAttribute('data-title', 'Helpware Welcome Agent');
    script.setAttribute('data-color', '#0E121B');
    script.setAttribute('data-auto-open', 'true');
    script.setAttribute('data-show-ai-popup', 'false');

    script.onload = function() {
      document.getElementById('widget-status').textContent = 'Script Loaded';
      document.getElementById('widget-status').className = 'status success';
      
      // Check for widget elements after a delay
      setTimeout(() => {
        const widgetElements = document.querySelectorAll('[id*="retell"], [class*="retell"]');
        if (widgetElements.length > 0) {
          document.getElementById('widget-status').textContent = `Widget Elements Found (${widgetElements.length})`;
          document.getElementById('widget-status').className = 'status success';
        } else {
          document.getElementById('widget-status').textContent = 'No Widget Elements Found';
          document.getElementById('widget-status').className = 'status error';
        }
      }, 2000);
    };

    script.onerror = function() {
      document.getElementById('widget-status').textContent = 'Script Failed to Load';
      document.getElementById('widget-status').className = 'status error';
    };

    document.head.appendChild(script);

    // Check for network errors
    window.addEventListener('error', function(e) {
      if (e.target.tagName === 'SCRIPT') {
        document.getElementById('widget-status').textContent = 'Script Load Error: ' + e.target.src;
        document.getElementById('widget-status').className = 'status error';
      }
    });

    // Log all network requests
    const originalFetch = window.fetch;
    window.fetch = function(...args) {
      console.log('Fetch request:', args[0]);
      return originalFetch.apply(this, args).catch(err => {
        console.error('Fetch error:', err);
        throw err;
      });
    };
  </script>
</body>
</html>
